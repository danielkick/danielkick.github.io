<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Daniel Kick">
<meta name="dcterms.date" content="2023-10-13">
<title>Worse is better and not doing things “right”</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="../../../styles.css">
</head>
<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../posts/DanielKick/index.html">
 <span class="menu-text">Posts</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="https://github.com/danielkick/Resume/blob/main/Resume.pdf">
 <span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/danielkick/Resume/blob/main/Curriculum-Vitae.pdf">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/danielkick"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/daniel-kick-5a449b9a/"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
<div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Worse is better and not doing things “right”</h1>
            <p class="subtitle lead">Avoid premature optimization</p>
                                <div class="quarto-categories">
                <div class="quarto-category">tacit knowledge</div>
                <div class="quarto-category">beginner</div>
                <div class="quarto-category">intermediate</div>
                <div class="quarto-category">code</div>
                <div class="quarto-category">deep learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Daniel Kick </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 13, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!-- https://commons.wikimedia.org/wiki/File:Alwac_III_computer,_1959.jpg --><p>“Worse is better” is an idea I get a lot of mileage out of. Here’s the crux of it:</p>
<blockquote class="blockquote">
<p>It refers to the argument that software quality does not necessarily increase with functionality: that there is a point where less functionality (“worse”) is a preferable option (“better”) in terms of practicality and usability. <a href="https://en.wikipedia.org/wiki/Worse_is_better">source</a></p>
</blockquote>
<p>I find this is useful descriptively<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> but also prescriptively as a way to spend less time doing work that doesn’t need to be done.</p>
<p>In brief the idea is that once you have something that works it’s often not worth altering it to make it faster, more efficient, or more elegant … at least initially. Optimization is important (<a href="../../../posts/DanielKick/230913_filtering_to_save_88pr_space/index.html">example</a> but what I’m talking about here <em>premature optimization</em>. Avoiding the urge to improve things that aren’t the priority can be difficult, especially when you conceptually know what you would change.</p>
<section id="simplified-example" class="level2"><h2 class="anchored" data-anchor-id="simplified-example">Simplified Example</h2>
<p>Here’s an example: I’m building a network that ‘compresses’ information. The key idea is that there’s a function, <code>f()</code>, takes in some number of values and outputs <em>fewer</em> values. We can use this function over and over again to compress the values more and more. Once they’re ‘compressed’ we can do the reverse procedure and get more values until we’re back at the starting number.</p>
<p>There’s a catch however, and that’s that the function can only output an integer number of values even if the number should be a fraction. It’s like this division function. If the <code>numerator</code> argument is the number of input values and it will return <code>numerator/3</code> values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>div_it <span class="ot">&lt;-</span> <span class="cf">function</span>(numerator, <span class="at">divisor =</span> <span class="dv">3</span>){</span>
<span id="cb1-2"><a href="#cb1-2"></a>  res <span class="ot">=</span> numerator<span class="sc">/</span>divisor</span>
<span id="cb1-3"><a href="#cb1-3"></a>  res <span class="ot">=</span> <span class="fu">round</span>(res)</span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="fu">return</span>(res)</span>
<span id="cb1-5"><a href="#cb1-5"></a>}</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">div_it</span>(<span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 33</code></pre>
</div>
</div>
<p>Because it can only return whole numbers, we can’t reverse this procedure and always get back the same number – sometimes we have to add or subtract a little bit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>inv_div_it <span class="ot">&lt;-</span> <span class="cf">function</span>(numerator, <span class="at">divisor =</span> <span class="dv">3</span>){</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">return</span>(numerator<span class="sc">*</span>divisor)</span>
<span id="cb3-3"><a href="#cb3-3"></a>}</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="fu">inv_div_it</span>(<span class="dv">33</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 99</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">inv_div_it</span>(<span class="dv">33</span>)<span class="sc">+</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100</code></pre>
</div>
</div>
<p>If we want to really compress the input (<code>f(X) |&gt; f(X) |&gt; f(X) |&gt; f(X)</code> or <code>f(f(f(f(X))))</code>) then the number of values at each level would be:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>vals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb7-3"><a href="#cb7-3"></a>  i_val <span class="ot">&lt;-</span> vals[<span class="fu">length</span>(vals)]</span>
<span id="cb7-4"><a href="#cb7-4"></a>  vals[<span class="fu">length</span>(vals)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">div_it</span>(i_val) </span>
<span id="cb7-5"><a href="#cb7-5"></a>}</span>
<span id="cb7-6"><a href="#cb7-6"></a>vals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100  33  11   4   1</code></pre>
</div>
</div>
<p>Ideally running the inverse procedure multiple times on the last output above (just one value) would output produce:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>vals_reverse <span class="ot">&lt;-</span> vals[<span class="fu">length</span>(vals)<span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb9-2"><a href="#cb9-2"></a>vals_reverse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   1   4  11  33 100</code></pre>
</div>
</div>
<p>But using the inverse function defined above (<code>inv_div_it()</code>) we get:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>recover_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb11-3"><a href="#cb11-3"></a>  i_val <span class="ot">&lt;-</span> recover_vals[<span class="fu">length</span>(recover_vals)]</span>
<span id="cb11-4"><a href="#cb11-4"></a>  recover_vals[<span class="fu">length</span>(recover_vals)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">inv_div_it</span>(i_val) </span>
<span id="cb11-5"><a href="#cb11-5"></a>}</span>
<span id="cb11-6"><a href="#cb11-6"></a>recover_vals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  3  9 27 81</code></pre>
</div>
</div>
<p>To get back to 100 values we need to add a new value (imagine appending a <code>1</code> to an array) sometimes, and drop a value others, or make no change to output other times.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>add_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a></span>
<span id="cb13-3"><a href="#cb13-3"></a>recover_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb13-5"><a href="#cb13-5"></a>  i_val <span class="ot">&lt;-</span> recover_vals[<span class="fu">length</span>(recover_vals)]</span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="fu">print</span>(add_vals[i])</span>
<span id="cb13-7"><a href="#cb13-7"></a>  recover_vals[<span class="fu">length</span>(recover_vals)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">inv_div_it</span>(i_val) <span class="sc">+</span> add_vals[i]</span>
<span id="cb13-8"><a href="#cb13-8"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] -1
[1] 0
[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>recover_vals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   1   4  11  33 100</code></pre>
</div>
</div>
<p>We could keep track of the remainder each time <code>f()</code> is called and use that to figure out when to add or subtract 1. That would be the <em>elegant and efficient</em> solution. We know the desired output (100 values) and the number of times <code>f()</code> was called (4) so we could also try changing the numbers in <code>add_vals</code> until we have four numbers that. This solution would be <em>inelegant but still effective</em>.</p>
<p>If a piece of code only needs to be a few times then the cost of the time you’d spend optimizing it will probably be worth more than than cost of the time the computer spends running it (<a href="https://xkcd.com/1205/">see also</a>).</p>
<p>If the sloppy way to express what you want is good enough then don’t worry about it. Good enough now is often better than perfect later.</p>
</section><section id="example-in-context-python" class="level2"><h2 class="anchored" data-anchor-id="example-in-context-python">Example in Context (<code>python</code>)</h2>
<p>The motivating problem behind this write up is that ‘compressing’ weather data (17 measurements for 365 days) into fewer values. I’m using a variation autoencoder with convolution layers which you can imagine as passing a sliding window over a 17x365 grid and summarizing each windowed chunk to get fewer values.</p>
<p>To check if the compression is effective, we have to compress 17x365 values down to something smaller (e.g.&nbsp;17x23), and inflate them back to 17x365 so we can compare the input weather to the output weather. If we can get back the same 17x365 values (or something pretty close) then the comprssion is effective..</p>
<p>From the input data’s length (days) you can calculate what a convolutional layer’s output length will be like so:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">def</span> L_out_conv1d(</span>
<span id="cb17-2"><a href="#cb17-2"></a>    L_in <span class="op">=</span> <span class="dv">365</span>, </span>
<span id="cb17-3"><a href="#cb17-3"></a>    kernel_size<span class="op">=</span><span class="dv">3</span>, stride <span class="op">=</span> <span class="dv">2</span>, padding<span class="op">=</span><span class="dv">1</span>, dilation <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>): <span class="cf">return</span> ((L_in <span class="op">+</span><span class="dv">2</span><span class="op">*</span>padding<span class="op">-</span>dilation<span class="op">*</span>(kernel_size<span class="op">-</span><span class="dv">1</span>)<span class="op">-</span><span class="dv">1</span>)<span class="op">/</span>stride)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb17-5"><a href="#cb17-5"></a></span>
<span id="cb17-6"><a href="#cb17-6"></a>L_out_conv1d(L_in <span class="op">=</span> <span class="dv">365</span>) <span class="co"># 183.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And the same for reversing the operation (with a transposed convolution).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">def</span> L_out_convT1d(</span>
<span id="cb18-2"><a href="#cb18-2"></a>    L_in <span class="op">=</span> <span class="dv">183</span>, </span>
<span id="cb18-3"><a href="#cb18-3"></a>    kernel_size<span class="op">=</span><span class="dv">3</span>, stride <span class="op">=</span> <span class="dv">2</span>, padding<span class="op">=</span><span class="dv">1</span>, output_padding<span class="op">=</span><span class="dv">0</span>, dilation <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>): <span class="cf">return</span> (L_in <span class="op">-</span> <span class="dv">1</span>)<span class="op">*</span>stride<span class="op">-</span><span class="dv">2</span><span class="op">*</span>padding<span class="op">+</span>dilation<span class="op">*</span>(kernel_size<span class="op">-</span><span class="dv">1</span>)<span class="op">+</span>output_padding<span class="op">+</span><span class="dv">1</span></span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a>L_out_convT1d(L_in <span class="op">=</span> <span class="dv">183</span>) <span class="co"># 365.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The trouble is that if I stack convolution layers the output length can become a fraction, which is forced to an integer, and prevents the reverse operation from producing the right number. When I use 4 layers the length should be <code>[365, 183.0, 92.0, 46.5, 23.75]</code> which as integers is <code>[365, 183, 92, 46, 23]</code>. Reversing the operation produces <code>[23, 45, 89, 177, 353]</code>.</p>
<p>We can get back to 365 days by increasing the output’s length in <em>some</em> of the transposed convolution layers by adding a non-zero <code>output_padding</code>. I don’t know how many layers will be best, so I can’t hard code these values. I could use the functions above to calculate what when the <code>output_padding</code> should be 0 and when it shouldn’t (the <em>elegant</em> solution), but that’s not what I did.</p>
<p>Instead I made a simple disposable neural network just to check if I had the <code>output_padding</code>s right by tracking the lengths of the tensor after each layer.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># input data. One observation, 17 measurements, 365 days of measurements. </span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="co"># It's all 0s because all I care about right now is the dimensions of the data.</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>xin <span class="op">=</span> torch.zeros((<span class="dv">1</span>, <span class="dv">17</span>, <span class="dv">365</span>))</span>
<span id="cb19-4"><a href="#cb19-4"></a></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="co"># Proposed output_padding for each layer in the decoder network</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>layer_output_padding <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb19-7"><a href="#cb19-7"></a></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co"># encoder network</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>ne <span class="op">=</span> nn.ModuleList([</span>
<span id="cb19-10"><a href="#cb19-10"></a>    nn.Sequential(nn.Conv1d(</span>
<span id="cb19-11"><a href="#cb19-11"></a>    <span class="dv">17</span>, out_channels<span class="op">=</span><span class="dv">17</span>, kernel_size<span class="op">=</span> <span class="dv">3</span>, stride<span class="op">=</span> <span class="dv">2</span>, padding  <span class="op">=</span> <span class="dv">1</span>), nn.BatchNorm1d(</span>
<span id="cb19-12"><a href="#cb19-12"></a>    <span class="dv">17</span>), nn.LeakyReLU())</span>
<span id="cb19-13"><a href="#cb19-13"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(layer_output_padding))</span>
<span id="cb19-14"><a href="#cb19-14"></a>])</span>
<span id="cb19-15"><a href="#cb19-15"></a></span>
<span id="cb19-16"><a href="#cb19-16"></a><span class="co"># Decoder network</span></span>
<span id="cb19-17"><a href="#cb19-17"></a>nd <span class="op">=</span> nn.ModuleList([</span>
<span id="cb19-18"><a href="#cb19-18"></a>    nn.Sequential(nn.ConvTranspose1d(</span>
<span id="cb19-19"><a href="#cb19-19"></a>    <span class="dv">17</span>, <span class="dv">17</span>, </span>
<span id="cb19-20"><a href="#cb19-20"></a>    kernel_size<span class="op">=</span><span class="dv">3</span>, stride <span class="op">=</span> <span class="dv">2</span>, padding<span class="op">=</span><span class="dv">1</span>, output_padding<span class="op">=</span>layer_output_padding[i]), nn.BatchNorm1d(</span>
<span id="cb19-21"><a href="#cb19-21"></a>    <span class="dv">17</span>), nn.LeakyReLU())</span>
<span id="cb19-22"><a href="#cb19-22"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(layer_output_padding))</span>
<span id="cb19-23"><a href="#cb19-23"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then I can run this network …</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># list to store lengths</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>tensor_Ls <span class="op">=</span> []</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co"># add the input data's length (days)</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>tensor_Ls <span class="op">+=</span> [<span class="bu">list</span>(xin.shape)[<span class="op">-</span><span class="dv">1</span>]] </span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="co"># encode data</span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="cf">for</span> mod <span class="kw">in</span> ne:</span>
<span id="cb20-9"><a href="#cb20-9"></a>    xin <span class="op">=</span> mod(xin)</span>
<span id="cb20-10"><a href="#cb20-10"></a>    tensor_Ls <span class="op">+=</span> [<span class="bu">list</span>(xin.shape)[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb20-11"><a href="#cb20-11"></a></span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="co"># add the encoded data's </span></span>
<span id="cb20-13"><a href="#cb20-13"></a>tensor_Ls <span class="op">+=</span> [<span class="bu">str</span>(tensor_Ls[<span class="op">-</span><span class="dv">1</span>])]</span>
<span id="cb20-14"><a href="#cb20-14"></a></span>
<span id="cb20-15"><a href="#cb20-15"></a><span class="co"># decode data</span></span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="cf">for</span> mod <span class="kw">in</span> nd:</span>
<span id="cb20-17"><a href="#cb20-17"></a>    xin <span class="op">=</span> mod(xin)</span>
<span id="cb20-18"><a href="#cb20-18"></a>    tensor_Ls <span class="op">+=</span> [<span class="bu">list</span>(xin.shape)[<span class="op">-</span><span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>… and look at the first and last value of the list of lengths (<code>tensor_Ls</code>) to see if the proposed output paddings will work.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>tensor_Ls[<span class="dv">0</span>] <span class="op">==</span> tensor_Ls[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="co"># False</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>tensor_Ls</span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="co"># [365, 183, 92, 46, 23, 12, 6, 3, 2, '2', 3, 5, 9, 17, 33, 65, 129, 257]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next I need a way to systematically produce different paddings. For a decoder of four layers I would test paddings <code>[0, 0, 0, 0], [1, 0, 0, 0], ... [1, 1, 1, 1]</code> stopping at the first list that works. So I’ll write a function to increment <code>[0, 0, 0, 0]</code> to <code>[1, 0, 0, 0]</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">def</span> increment_list(</span>
<span id="cb22-2"><a href="#cb22-2"></a>    in_list <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>],</span>
<span id="cb22-3"><a href="#cb22-3"></a>    min_value <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb22-4"><a href="#cb22-4"></a>    max_value <span class="op">=</span> <span class="dv">1</span>):</span>
<span id="cb22-5"><a href="#cb22-5"></a>    <span class="co"># Check that all entries are within min/max</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>    <span class="cf">if</span> <span class="va">False</span> <span class="kw">in</span> [<span class="va">True</span> <span class="cf">if</span> e <span class="op">&lt;=</span> max_value <span class="cf">else</span> <span class="va">False</span> <span class="cf">for</span> e <span class="kw">in</span> in_list]:</span>
<span id="cb22-7"><a href="#cb22-7"></a>        <span class="bu">print</span>(<span class="st">'Value(s) above maximum!'</span>)</span>
<span id="cb22-8"><a href="#cb22-8"></a>    <span class="cf">elif</span> <span class="va">False</span> <span class="kw">in</span> [<span class="va">True</span> <span class="cf">if</span> e <span class="op">&gt;=</span> min_value <span class="cf">else</span> <span class="va">False</span> <span class="cf">for</span> e <span class="kw">in</span> in_list]:</span>
<span id="cb22-9"><a href="#cb22-9"></a>        <span class="bu">print</span>(<span class="st">'Value(s) below minimum!'</span>)</span>
<span id="cb22-10"><a href="#cb22-10"></a>    <span class="cf">elif</span> [e <span class="cf">for</span> e <span class="kw">in</span> in_list <span class="cf">if</span> e <span class="op">!=</span> max_value] <span class="op">==</span> []:</span>
<span id="cb22-11"><a href="#cb22-11"></a>        <span class="bu">print</span>(<span class="st">'List at maximum value!'</span>)</span>
<span id="cb22-12"><a href="#cb22-12"></a>    <span class="cf">else</span>:    </span>
<span id="cb22-13"><a href="#cb22-13"></a>        <span class="co"># start cursor at first non-max value</span></span>
<span id="cb22-14"><a href="#cb22-14"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(in_list)):</span>
<span id="cb22-15"><a href="#cb22-15"></a>            <span class="cf">if</span> in_list[i] <span class="op">&lt;</span> max_value:</span>
<span id="cb22-16"><a href="#cb22-16"></a>                in_list[i] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb22-17"><a href="#cb22-17"></a>                <span class="cf">break</span></span>
<span id="cb22-18"><a href="#cb22-18"></a>            <span class="cf">else</span>:</span>
<span id="cb22-19"><a href="#cb22-19"></a>                in_list[i] <span class="op">=</span> min_value</span>
<span id="cb22-20"><a href="#cb22-20"></a>    <span class="cf">return</span>(in_list)</span>
<span id="cb22-21"><a href="#cb22-21"></a></span>
<span id="cb22-22"><a href="#cb22-22"></a>increment_list()</span>
<span id="cb22-23"><a href="#cb22-23"></a><span class="co"># [1, 0, 0, 0]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then we can loop through possible paddings until we find one that works or have tried all of them.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Proposed output_padding for each layer in the decoder network</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>layer_output_padding <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb23-5"><a href="#cb23-5"></a>    <span class="co"># save a backup of the current padding</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>    old_layer_output_padding <span class="op">=</span> layer_output_padding.copy()</span>
<span id="cb23-7"><a href="#cb23-7"></a>    </span>
<span id="cb23-8"><a href="#cb23-8"></a>    </span>
<span id="cb23-9"><a href="#cb23-9"></a>    <span class="co"># ... define and run network here ...</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>    </span>
<span id="cb23-11"><a href="#cb23-11"></a>    </span>
<span id="cb23-12"><a href="#cb23-12"></a>    <span class="co"># If it did work we're done</span></span>
<span id="cb23-13"><a href="#cb23-13"></a>    <span class="cf">if</span> <span class="va">True</span> <span class="op">==</span> (tensor_Ls[<span class="dv">0</span>] <span class="op">==</span> tensor_Ls[<span class="op">-</span><span class="dv">1</span>]):</span>
<span id="cb23-14"><a href="#cb23-14"></a>        <span class="bu">print</span>(<span class="st">'done!'</span>)</span>
<span id="cb23-15"><a href="#cb23-15"></a>        </span>
<span id="cb23-16"><a href="#cb23-16"></a>    <span class="co"># If the padding _didn't_ work change it</span></span>
<span id="cb23-17"><a href="#cb23-17"></a>    <span class="cf">else</span>:</span>
<span id="cb23-18"><a href="#cb23-18"></a>        layer_output_padding <span class="op">=</span> increment_list(</span>
<span id="cb23-19"><a href="#cb23-19"></a>            in_list <span class="op">=</span> layer_output_padding,</span>
<span id="cb23-20"><a href="#cb23-20"></a>            min_value <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb23-21"><a href="#cb23-21"></a>            max_value <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb23-22"><a href="#cb23-22"></a>    </span>
<span id="cb23-23"><a href="#cb23-23"></a>    <span class="co"># If the proposed new padding is the same as the backup, then we have tried all the possible paddings and will stop. </span></span>
<span id="cb23-24"><a href="#cb23-24"></a>    <span class="cf">if</span> layer_output_padding <span class="op">==</span> old_layer_output_padding: </span>
<span id="cb23-25"><a href="#cb23-25"></a>        <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="all-together" class="level3"><h3 class="anchored" data-anchor-id="all-together">All together</h3>
<p>Here’s the full loop and its output:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="co"># Proposed output_padding for each layer in the decoder network</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>layer_output_padding <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb24-4"><a href="#cb24-4"></a></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb24-6"><a href="#cb24-6"></a>    <span class="co"># save a backup of the current padding</span></span>
<span id="cb24-7"><a href="#cb24-7"></a>    old_layer_output_padding <span class="op">=</span> layer_output_padding.copy()</span>
<span id="cb24-8"><a href="#cb24-8"></a>    </span>
<span id="cb24-9"><a href="#cb24-9"></a>    <span class="co"># input data. One observation, 17 measurements, 365 days of measurements. </span></span>
<span id="cb24-10"><a href="#cb24-10"></a>    <span class="co"># It's all 0s because all I care about right now is the dimensions of the data.</span></span>
<span id="cb24-11"><a href="#cb24-11"></a>    xin <span class="op">=</span> torch.zeros((<span class="dv">1</span>, <span class="dv">17</span>, <span class="dv">365</span>))</span>
<span id="cb24-12"><a href="#cb24-12"></a></span>
<span id="cb24-13"><a href="#cb24-13"></a>    <span class="co"># encoder network</span></span>
<span id="cb24-14"><a href="#cb24-14"></a>    ne <span class="op">=</span> nn.ModuleList([</span>
<span id="cb24-15"><a href="#cb24-15"></a>        nn.Sequential(nn.Conv1d(</span>
<span id="cb24-16"><a href="#cb24-16"></a>        <span class="dv">17</span>, out_channels<span class="op">=</span><span class="dv">17</span>, kernel_size<span class="op">=</span> <span class="dv">3</span>, stride<span class="op">=</span> <span class="dv">2</span>, padding  <span class="op">=</span> <span class="dv">1</span>), nn.BatchNorm1d(</span>
<span id="cb24-17"><a href="#cb24-17"></a>        <span class="dv">17</span>), nn.LeakyReLU())</span>
<span id="cb24-18"><a href="#cb24-18"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(layer_output_padding))</span>
<span id="cb24-19"><a href="#cb24-19"></a>    ])</span>
<span id="cb24-20"><a href="#cb24-20"></a></span>
<span id="cb24-21"><a href="#cb24-21"></a>    <span class="co"># Decoder network</span></span>
<span id="cb24-22"><a href="#cb24-22"></a>    nd <span class="op">=</span> nn.ModuleList([</span>
<span id="cb24-23"><a href="#cb24-23"></a>        nn.Sequential(nn.ConvTranspose1d(</span>
<span id="cb24-24"><a href="#cb24-24"></a>        <span class="dv">17</span>, <span class="dv">17</span>, </span>
<span id="cb24-25"><a href="#cb24-25"></a>        kernel_size<span class="op">=</span><span class="dv">3</span>, stride <span class="op">=</span> <span class="dv">2</span>, padding<span class="op">=</span><span class="dv">1</span>, output_padding<span class="op">=</span>layer_output_padding[i]), nn.BatchNorm1d(</span>
<span id="cb24-26"><a href="#cb24-26"></a>        <span class="dv">17</span>), nn.LeakyReLU())</span>
<span id="cb24-27"><a href="#cb24-27"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(layer_output_padding))</span>
<span id="cb24-28"><a href="#cb24-28"></a>    ])</span>
<span id="cb24-29"><a href="#cb24-29"></a>    </span>
<span id="cb24-30"><a href="#cb24-30"></a>    <span class="co"># list to store lengths</span></span>
<span id="cb24-31"><a href="#cb24-31"></a>    tensor_Ls <span class="op">=</span> []</span>
<span id="cb24-32"><a href="#cb24-32"></a></span>
<span id="cb24-33"><a href="#cb24-33"></a>    <span class="co"># add the input data's length (days)</span></span>
<span id="cb24-34"><a href="#cb24-34"></a>    tensor_Ls <span class="op">+=</span> [<span class="bu">list</span>(xin.shape)[<span class="op">-</span><span class="dv">1</span>]] </span>
<span id="cb24-35"><a href="#cb24-35"></a></span>
<span id="cb24-36"><a href="#cb24-36"></a>    <span class="co"># encode data</span></span>
<span id="cb24-37"><a href="#cb24-37"></a>    <span class="cf">for</span> mod <span class="kw">in</span> ne:</span>
<span id="cb24-38"><a href="#cb24-38"></a>        xin <span class="op">=</span> mod(xin)</span>
<span id="cb24-39"><a href="#cb24-39"></a>        tensor_Ls <span class="op">+=</span> [<span class="bu">list</span>(xin.shape)[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb24-40"><a href="#cb24-40"></a></span>
<span id="cb24-41"><a href="#cb24-41"></a>    <span class="co"># add the encoded data's </span></span>
<span id="cb24-42"><a href="#cb24-42"></a>    tensor_Ls <span class="op">+=</span> [<span class="bu">str</span>(tensor_Ls[<span class="op">-</span><span class="dv">1</span>])]</span>
<span id="cb24-43"><a href="#cb24-43"></a></span>
<span id="cb24-44"><a href="#cb24-44"></a>    <span class="co"># decode data</span></span>
<span id="cb24-45"><a href="#cb24-45"></a>    <span class="cf">for</span> mod <span class="kw">in</span> nd:</span>
<span id="cb24-46"><a href="#cb24-46"></a>        xin <span class="op">=</span> mod(xin)</span>
<span id="cb24-47"><a href="#cb24-47"></a>        tensor_Ls <span class="op">+=</span> [<span class="bu">list</span>(xin.shape)[<span class="op">-</span><span class="dv">1</span>]]    </span>
<span id="cb24-48"><a href="#cb24-48"></a>    </span>
<span id="cb24-49"><a href="#cb24-49"></a>    <span class="co"># If it did work we're done</span></span>
<span id="cb24-50"><a href="#cb24-50"></a>    <span class="cf">if</span> <span class="va">True</span> <span class="op">==</span> (tensor_Ls[<span class="dv">0</span>] <span class="op">==</span> tensor_Ls[<span class="op">-</span><span class="dv">1</span>]):</span>
<span id="cb24-51"><a href="#cb24-51"></a>        <span class="bu">print</span>(<span class="st">'done!'</span>)</span>
<span id="cb24-52"><a href="#cb24-52"></a>        </span>
<span id="cb24-53"><a href="#cb24-53"></a>    <span class="co"># If the padding _didn't_ work change it</span></span>
<span id="cb24-54"><a href="#cb24-54"></a>    <span class="cf">else</span>:</span>
<span id="cb24-55"><a href="#cb24-55"></a>        layer_output_padding <span class="op">=</span> increment_list(</span>
<span id="cb24-56"><a href="#cb24-56"></a>            in_list <span class="op">=</span> layer_output_padding,</span>
<span id="cb24-57"><a href="#cb24-57"></a>            min_value <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb24-58"><a href="#cb24-58"></a>            max_value <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb24-59"><a href="#cb24-59"></a>    </span>
<span id="cb24-60"><a href="#cb24-60"></a>    <span class="co"># If the proposed new padding is the same as the backup, then we have tried all the possible paddings and will stop. </span></span>
<span id="cb24-61"><a href="#cb24-61"></a>    <span class="cf">if</span> layer_output_padding <span class="op">==</span> old_layer_output_padding: </span>
<span id="cb24-62"><a href="#cb24-62"></a>        <span class="cf">break</span></span>
<span id="cb24-63"><a href="#cb24-63"></a></span>
<span id="cb24-64"><a href="#cb24-64"></a><span class="co"># done!</span></span>
<span id="cb24-65"><a href="#cb24-65"></a></span>
<span id="cb24-66"><a href="#cb24-66"></a>layer_output_padding  </span>
<span id="cb24-67"><a href="#cb24-67"></a><span class="co"># [0, 1, 1, 0, 1, 1, 0, 0]</span></span>
<span id="cb24-68"><a href="#cb24-68"></a></span>
<span id="cb24-69"><a href="#cb24-69"></a>tensor_Ls</span>
<span id="cb24-70"><a href="#cb24-70"></a><span class="co"># [365, 183, 92, 46, 23, 12, 6, 3, 2, '2', 3, 6, 12, 23, 46, 92, 183, 365]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This may not be as not as <em>elegant</em> or as <em>efficient</em> as it could be, but it doesn’t matter. It only takes about 200ms so it’s not worth improving unless.</p>


</section></section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>e.g.&nbsp;If scientific manuscripts with embedded code are valuable for reproducibility, why haven’t they become the default? There’s a lot of energy needed to switch and all of your collaborators already know word. 🤷🏼‍♂ <a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
      <div class="nav-footer-center"><a href="mailto:hello@danielkick.com">Contact Daniel</a></div>
    <div class="nav-footer-right"><a href="https://github.com/danielkick/danielkick.github.io">View the Source</a></div>
  </div>
</footer>


</body></html>